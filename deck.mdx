import { CodeSurfer, CodeSurferColumns, Step } from "code-surfer";
import { duotoneDark, github } from "@code-surfer/themes";

import BasicUsageDemo from "./components/basic-usage/demo.jsx";
import HomemadeBasicUsageWithoutCache from './components/basic-usage/homemade/BasicUsageWithoutCache.jsx'
import HomemadeBasicUsage from './components/basic-usage/homemade/BasicUsage.jsx'

<CodeSurferColumns themes={[duotoneDark, github]} sizes={[1, 1]}>

<Step>

```jsx title="Basic Usage"
import { useState } from "react";
import useSWR from "swr";

const fetcher = (id) =>
  fetch(`https://api.github.com/repos/${id}`).then((r) =>
    r.json()
  );

export default function TrendingProjects() {
  const [id, setId] = useState("facebook/react");
  const { data } = useSWR(id, fetcher);

  return (
    <div>
      <h1>Trending Projects</h1>

      <div>
        <button onClick={() => setId("facebook/react")}>
          React
        </button>{" "}
        <button onClick={() => setId("vercel/swr")}>
          SWR
        </button>{" "}
        <button onClick={() => setId("TanStack/query")}>
          TanStack Query
        </button>
      </div>

      {data ? (
        <div>
          <h2>{id}</h2>
          <p>forks: {data.forks_count}</p>
          <p>stars: {data.stargazers_count}</p>
          <p>watchers: {data.watchers}</p>
        </div>
      ) : (
        <p>loading...</p>
      )}
    </div>
  );
}
```

<div style={{ height: "50%", width: "80%", fontSize: 20 }}>
  <BasicUsageDemo />
</div>

</Step>

</CodeSurferColumns>

---

<CodeSurfer theme={duotoneDark}>

```jsx
import { useState } from "react";
import useSWR from "swr";

const fetcher = (id) =>
  fetch(`https://api.github.com/repos/${id}`).then((r) =>
    r.json()
  );

export default function TrendingProjects() {
  const [id, setId] = useState("facebook/react");
  const { data } = useSWR(id, fetcher);

  return (
    <div>
      <h1>Trending Projects</h1>

      <div>
        <button onClick={() => setId("facebook/react")}>
          React
        </button>{" "}
        <button onClick={() => setId("vercel/swr")}>
          SWR
        </button>{" "}
        <button onClick={() => setId("TanStack/query")}>
          TanStack Query
        </button>
      </div>

      {data ? (
        <div>
          <h2>{id}</h2>
          <p>forks: {data.forks_count}</p>
          <p>stars: {data.stargazers_count}</p>
          <p>watchers: {data.watchers}</p>
        </div>
      ) : (
        <p>loading...</p>
      )}
    </div>
  );
}
```

```jsx subtitle="Let's build our own SWR!"
import { useState } from "react";

const useSWR = {}

const fetcher = (id) =>
  fetch(`https://api.github.com/repos/${id}`).then((r) =>
    r.json()
  );

export default function TrendingProjects() {
  const [id, setId] = useState("facebook/react");
  const { data } = useSWR(id, fetcher);

  return (
    <div>
      <h1>Trending Projects</h1>

      <div>
        <button onClick={() => setId("facebook/react")}>
          React
        </button>{" "}
        <button onClick={() => setId("vercel/swr")}>
          SWR
        </button>{" "}
        <button onClick={() => setId("TanStack/query")}>
          TanStack Query
        </button>
      </div>

      {data ? (
        <div>
          <h2>{id}</h2>
          <p>forks: {data.forks_count}</p>
          <p>stars: {data.stargazers_count}</p>
          <p>watchers: {data.watchers}</p>
        </div>
      ) : (
        <p>loading...</p>
      )}
    </div>
  );
}
```

```jsx
import { useState } from "react";

const useSWR = (key, fetcher) => {
  const [data, setData] = useState();

  return { data };
};

const fetcher = (id) =>
  fetch(`https://api.github.com/repos/${id}`).then((r) =>
    r.json()
  );

export default function TrendingProjects() {
  const [id, setId] = useState("facebook/react");
  const { data } = useSWR(id, fetcher);

  return (
    <div>
      <h1>Trending Projects</h1>

      <div>
        <button onClick={() => setId("facebook/react")}>
          React
        </button>{" "}
        <button onClick={() => setId("vercel/swr")}>
          SWR
        </button>{" "}
        <button onClick={() => setId("TanStack/query")}>
          TanStack Query
        </button>
      </div>

      {data ? (
        <div>
          <h2>{id}</h2>
          <p>forks: {data.forks_count}</p>
          <p>stars: {data.stargazers_count}</p>
          <p>watchers: {data.watchers}</p>
        </div>
      ) : (
        <p>loading...</p>
      )}
    </div>
  );
}
```

```jsx
import { useState } from "react";

const useSWR = (key, fetcher) => {
  const [data, setData] = useState();

  useEffect(() => {
    async function fetch() {
      setData(undefined);
      const newData = await fetcher(key);
      setData(newData);
    }
    fetch();
  }, [fetcher, key]);

  return { data };
};

const fetcher = (id) =>
  fetch(`https://api.github.com/repos/${id}`).then((r) =>
    r.json()
  );

export default function TrendingProjects() {
  const [id, setId] = useState("facebook/react");
  const { data } = useSWR(id, fetcher);

  return (
    <div>
      <h1>Trending Projects</h1>

      <div>
        <button onClick={() => setId("facebook/react")}>
          React
        </button>{" "}
        <button onClick={() => setId("vercel/swr")}>
          SWR
        </button>{" "}
        <button onClick={() => setId("TanStack/query")}>
          TanStack Query
        </button>
      </div>

      {data ? (
        <div>
          <h2>{id}</h2>
          <p>forks: {data.forks_count}</p>
          <p>stars: {data.stargazers_count}</p>
          <p>watchers: {data.watchers}</p>
        </div>
      ) : (
        <p>loading...</p>
      )}
    </div>
  );
}
```

</CodeSurfer>

---

<CodeSurferColumns themes={[duotoneDark, github]} sizes={[1, 1]}>

<Step>

```jsx
import { useState, useEffect } from "react";

const useSWR = (key, fetcher) => {
  const [data, setData] = useState();

  useEffect(() => {
    async function fetch() {
      setData(undefined);
      const newData = await fetcher(key);
      setData(newData);
    }
    fetch();
  }, [fetcher, key]);

  return { data };
};

const fetcher = (id) =>
  fetch(`https://api.github.com/repos/${id}`).then((r) =>
    r.json()
  );

export default function TrendingProjects() {
  const [id, setId] = useState("facebook/react");
  const { data } = useSWR(id, fetcher);

  return (
    <div>
      <h1>Trending Projects</h1>
      <button onClick={() => setId("facebook/react")}>
        React
      </button>{" "}
      <button onClick={() => setId("vercel/swr")}>
        SWR
      </button>{" "}
      <button onClick={() => setId("TanStack/query")}>
        TanStack Query
      </button>
      {data ? (
        <div>
          <h2>{id}</h2>
          <p>forks: {data.forks_count}</p>
          <p>stars: {data.stargazers_count}</p>
          <p>watchers: {data.watchers}</p>
        </div>
      ) : (
        <p>loading...</p>
      )}
    </div>
  );
}
```

<div style={{ height: "50%", width: "80%", fontSize: 20 }}>
  <HomemadeBasicUsageWithoutCache />
</div>

</Step>

</CodeSurferColumns>

---

<CodeSurfer theme={duotoneDark}>

```jsx 3:16 subtitle="Let's add the cache!(excalidraw)"
import { useState, useEffect } from "react";

const useSWR = (key, fetcher) => {
  const [data, setData] = useState();

  useEffect(() => {
    async function fetch() {
      setData(undefined);
      const newData = await fetcher(key);
      setData(newData);
    }
    fetch();
  }, [fetcher, key]);

  return { data };
};

const fetcher = (id) =>
  fetch(`https://api.github.com/repos/${id}`).then((r) =>
    r.json()
  );

export default function TrendingProjects() {
  const [id, setId] = useState("facebook/react");
  const { data } = useSWR(id, fetcher);

  return (
    <div>
      <h1>Trending Projects</h1>
      <button onClick={() => setId("facebook/react")}>
        React
      </button>{" "}
      <button onClick={() => setId("vercel/swr")}>
        SWR
      </button>{" "}
      <button onClick={() => setId("TanStack/query")}>
        TanStack Query
      </button>
      {data ? (
        <div>
          <h2>{id}</h2>
          <p>forks: {data.forks_count}</p>
          <p>stars: {data.stargazers_count}</p>
          <p>watchers: {data.watchers}</p>
        </div>
      ) : (
        <p>loading...</p>
      )}
    </div>
  );
}
```

```jsx
import { useState, useEffect } from "react";

const cache = new Map();

const useSWR = (key, fetcher) => {
  const keyRef = useRef(key);
  const [data, setData] = useState();

  useEffect(() => {
    async function fetch() {
      const newData = await fetcher(key);

      keyRef.current = key;
      cache.set(key, newData);

      setData(newData);
    }
    fetch();
  }, [fetcher, key]);

  return {
    data: keyRef.current === key ? data : cache.get(key),
  };
};

const fetcher = (id) =>
  fetch(`https://api.github.com/repos/${id}`).then((r) =>
    r.json()
  );

export default function TrendingProjects() {
  const [id, setId] = useState("facebook/react");
  const { data } = useSWR(id, fetcher);

  return (
    <div>
      <h1>Trending Projects</h1>
      <button onClick={() => setId("facebook/react")}>
        React
      </button>{" "}
      <button onClick={() => setId("vercel/swr")}>
        SWR
      </button>{" "}
      <button onClick={() => setId("TanStack/query")}>
        TanStack Query
      </button>
      {data ? (
        <div>
          <h2>{id}</h2>
          <p>forks: {data.forks_count}</p>
          <p>stars: {data.stargazers_count}</p>
          <p>watchers: {data.watchers}</p>
        </div>
      ) : (
        <p>loading...</p>
      )}
    </div>
  );
}
```

</CodeSurfer>

---

<CodeSurferColumns themes={[duotoneDark, github]} sizes={[1, 1]}>

<Step>

```jsx
import { useState, useEffect } from "react";

const cache = new Map();

const useSWR = (key, fetcher) => {
  const keyRef = useRef(key);
  const [data, setData] = useState();

  useEffect(() => {
    async function fetch() {
      const newData = await fetcher(key);

      keyRef.current = key;
      cache.set(key, newData);

      setData(newData);
    }
    fetch();
  }, [fetcher, key]);

  return {
    data: keyRef.current === key ? data : cache.get(key),
  };
};

const fetcher = (id) =>
  fetch(`https://api.github.com/repos/${id}`).then((r) =>
    r.json()
  );

export default function TrendingProjects() {
  const [id, setId] = useState("facebook/react");
  const { data } = useSWR(id, fetcher);

  return (
    <div>
      <h1>Trending Projects</h1>
      <button onClick={() => setId("facebook/react")}>
        React
      </button>{" "}
      <button onClick={() => setId("vercel/swr")}>
        SWR
      </button>{" "}
      <button onClick={() => setId("TanStack/query")}>
        TanStack Query
      </button>
      {data ? (
        <div>
          <h2>{id}</h2>
          <p>forks: {data.forks_count}</p>
          <p>stars: {data.stargazers_count}</p>
          <p>watchers: {data.watchers}</p>
        </div>
      ) : (
        <p>loading...</p>
      )}
    </div>
  );
}
```

<div style={{ height: "50%", width: "80%", fontSize: 20 }}>
  <HomemadeBasicUsage />
</div>

</Step>

</CodeSurferColumns>